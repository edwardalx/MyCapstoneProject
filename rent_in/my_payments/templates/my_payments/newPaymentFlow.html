{% extends "accounts/new_base.html" %}
{% load static %}

{% block content %}
<section>
  <h2>Make a Payment</h2>

  <!-- Property Dropdown -->
  <label for="property">Property:</label><br>
  <select id="property" name="property" required {% if property %}disabled{% endif %}>
    {% if property %}
      <option value="{{ property.id }}" selected>{{ property.name }}</option>
    {% else %}
      <option value="">-- Select Property --</option>
      {% for p in properties %}
        <option value="{{ p.id }}">{{ p.name }}</option>
      {% endfor %}
    {% endif %}
  </select><br><br>

  <!-- Unit Dropdown -->
  <label for="unit">Room:</label><br>
  <select id="unit" name="unit" required {% if unit %}disabled{% endif %}>
    {% if unit %}
      <option value="{{ unit.id }}" selected data-cost="{{ unit.cost }}">
        Room {{ unit.room_number }} - GHS {{ unit.cost }}/month
      </option>
    {% else %}
      <option value="">-- Select Room --</option>
    {% endif %}
  </select><br><br>

  <!-- Payment Form -->
  <form id="paymentForm" {% if not unit %}style="display:none;"{% endif %}>
    {% csrf_token %}
    <input type="hidden" id="tenant_id" value="{{ user.id }}">
    <input type="hidden" id="unit_id" value="{% if unit %}{{ unit.id }}{% endif %}">

    <label>Email:</label><br>
    <input type="email" id="email" value="{{ user.email }}" required><br><br>

    <label>Phone Number:</label><br>
    <input type="text" id="phone" value="{{ user.phoneNo }}" required><br><br>

    <label>Amount (GHS):</label><br>
    <input type="number" id="amount" value="{% if unit %}{{ unit.cost }}{% endif %}" readonly><br><br>

    <label>Provider:</label><br>
    <select id="provider" required>
      <option value="">-- Select Network --</option>
      <option value="mtn">MTN</option>
      <option value="vodafone">Vodafone</option>
      <option value="airteltigo">AirtelTigo</option>
    </select><br><br>

    <button type="button" onclick="payWithPaystack()">Pay Now</button>
  </form>
</section>
{% endblock %}

{% block extra_js %}
  <!-- Indicates whether unit was prepopulated to auto-show form -->
  {{ unit|yesno:"true,false"|json_script:"unit-data" }}

  <!-- Set your URL route name here -->
  <script>
    window.initializePaymentUrl = "{% url 'initialize_payment' %}";
  </script>

  <!-- Paystack + Custom Logic -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="{% static 'js/payment.js' %}"></script>
{% endblock %}
